<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>社團活動一覽</title>
    <style>
        .label_show{
            float: right;
            text-align: center;
            width: 80px;
            border-radius: 10px;
            margin-left: 5px;
        }
        /* 預設情況下，顯示電腦版搜尋框，隱藏手機版搜尋框 */
        #search_input_mobile {
            display: none;
        }

        #search_input_net {
            display: flex;
        }
        #event_list .modal-footer {
            justify-content: flex-end; /* 置中對齊 */
        }

        /* 當螢幕寬度小於等於 768px 時，顯示手機版搜尋框，隱藏電腦版搜尋框 */
        @media (max-width: 768px) {
            #search_input_mobile {
                display: block !important;
            }

            #search_input_net {
                display: none !important;
            }
            #event_list .modal-footer {
                justify-content: center !important; /* 置中對齊 */
            }
        }

    </style>
</head>
<body>
    <!-- navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand tohome" href="#"><i style="font-size: 25px;color: #6c757d;" class="bi bi-house-door-fill"  onclick="GoBackIdx('index')"></i></a>
        <div class="ml-auto"><input onclick="GoBackIdx('append')" type="button"class="btn btn-outline-secondary" value="我要開團" /></div>
    </nav>
    <div class="container p-5">
        <!-- 搜尋框 -->
        <div class=" mb-3">
            <!-- 手機版本 過濾器 -->
            <div id="search_input_mobile">
                <div class="input-group">
                    <input class="form-control "style="width: 65%;"/>
                    <div class="col-1 d-flex justify-content-center align-items-center  btn btn-secondary  " style="flex: 10%;">
                        <i class="bi bi-search"></i>
                    </div>
                </div>
            </div>
            <!-- 電腦版本 過濾器 -->
            <div id="search_input_net" style="display: flex;">
                <div class="input-group"  style="flex: 25%;">
                    <!-- 發起人 -->
                    <div class="input-group-prepend" title="活動發起人">
                        <span class="input-group-text" ><i class="bi bi-person"></i></span>
                    </div>
                    <select class="custom-select "style="width: 75%;" id="search_user">
                        <option value="" selected>全部</option>
                    </select>
                </div>
                <div class="input-group"  style="flex: 30%;">
                    <!-- 活動日期 -->
                    <div class="input-group-prepend" title="活動日期">
                        <span class="input-group-text"><i class="bi bi-calendar-event"></i></span>
                    </div>
                    <input type="text" class="form-control daterange" id="search_date">
                </div>
                <div class="input-group"  style="flex: 25%;">
                    <!-- 開團狀態 -->
                    <div class="input-group-prepend" title="開團狀態">
                        <span class="input-group-text"><i class="bi bi-cast"></i></span>
                    </div>
                    <select class="custom-select "style="width: 75%;" id="search_status">
                        <option value="" selected>全部狀態</option>
                        <option value="success" class="bg-success" style="color: white;">已成團</option>
                        <option value="durning" class="bg-warning">報名中</option>
                        <option value="fault" class="bg-secondary" style="color: white;">已流團</option>
                    </select>
                </div>
                <div class="col-1 d-flex justify-content-center align-items-center  btn btn-secondary ml-1 " style="flex: 10%;">
                    <i class="bi bi-search"></i>
                </div>
                <div class="col-1 d-flex justify-content-center align-items-center btn btn-secondary ml-1 " style="flex: 10%;">
                    <i class="bi bi-stars"></i>
                </div>
            </div>
        </div>
        <!-- 摺疊內容 -->
        <div class="accordion" id="event_list" style="border-color: #d8d8d8;">
          
        </div>
    </div>
</body>
<script type="text/javascript" src="../../public/main/main.js"></script>
<script type="text/javascript" src="Fitness.js"></script>
<script>
    // 轉成全域變數給文件使用
    var event_list;
    // 先跑完加載，再跑自己的fn
    loadResourcesAndRun().then(
        (reslove) => {
            /* 讀取社團活動列表*/
            // 先把需要的資料讀近來，避免跑AJAX太慢
            event_list = GetGasData("社團活動");
            var [header, ...data] = event_list;
            event_list = data
            .filter((row) => row[0] !== '' && row[10] == '已審核') // 過濾掉 id 為空的資料
            .map((row) =>
                header.reduce((acc, key, index) => ({ ...acc, [key]: row[index] }), {})
            );
            // 依造日期排序
            event_list.sort(function (a, b) {
                return Date.parse(b.event_time) - Date.parse(a.event_time); // 時間較晚的排在前面
            });
            //取得 html
            event_html = GetEventHtml(event_list);
            $("#event_list").append(event_html);
            //  讀取二樓人員的名單
            var member_list = event_member;
            var ops = "";
            $(member_list).each(function(idx,val){
                ops += '<option value="'+val+'" >'+val+'</option>';
            })
            $("#search_user").append(ops);
            $("#search_user").val("");
            // 日期區間元件
            $('.daterange').daterangepicker( {
                applyClass: 'btn-sm btn-success',
                cancelClass: 'btn-sm btn-default',
                autoUpdateInput: false,
                locale: {
                    applyLabel: '確認',
                    cancelLabel: '清除',
                    fromLabel: '開始時間',
                    toLabel: '結束時間',
                    customRangeLabel: '自定義',
                    firstDay: 1,
                    daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
                    monthNames: ['一月', '二月', '三月', '四月', '五月', '六月',
                        '七月', '八月', '九月', '十月', '十一月', '十二月'], 
                    format: 'YYYY-MM-DD', // 初始上面顯示的格式
                    separator: '~',
                },
                ranges: {
                    '今日': [moment().startOf('day').format('YYYY-MM-DD'), moment().startOf('day').format('YYYY-MM-DD')],
                    '昨日': [moment().subtract(1, 'days').startOf('day'), moment().subtract(1, 'days').endOf('day')],
                    '最近7日': [moment().subtract(6,'days'), moment()],
                    '最近30日': [moment().subtract(29, 'days'), moment()],
                    '本月': [moment().startOf("month"), moment().endOf("month")],
                    '上个月': [moment().subtract(1, "month").startOf("month"), moment().subtract(1, "month").endOf("month")],
                },
                opens: 'right',    
                showWeekNumbers: false,     
            });
            $('.daterange').on('cancel.daterangepicker', function (ev, picker) {
                $(this).val('');
            });
            $('.daterange').on('apply.daterangepicker', function (ev, picker) {
                $(this).val(picker.startDate.format('YYYY-MM-DD') +'~'+ picker.endDate.format('YYYY-MM-DD'));
            });


        }
    )

</script>

</html>