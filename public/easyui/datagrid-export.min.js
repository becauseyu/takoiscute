!function(h){function p(t){t=h(t).data("datagrid");return(t.filterSource||t.data).rows}function f(t){return h(t).data("datagrid").data.footer||[]}function d(t,e,n,o,l){e=(e=e||p(t)).concat(n||f(t));var r=h(t),i=['<table border="1" rull="all" style="border-collapse:collapse">'],l=l||r.datagrid("getColumnFields",!0).concat(r.datagrid("getColumnFields",!1)),s="height:32px",c="vertical-align:middle;padding:0 4px";o&&i.push("<caption>"+o+"</caption>"),i.push('<tr style="'+s+'">');for(var a=0;a<l.length;a++){var d=r.datagrid("getColumnOption",l[a]),u=c+";width:"+d.boxWidth+"px;";u+=";text-align:"+(d.halign||d.align||""),i.push('<td style="'+u+'">'+d.title+"</td>")}return i.push("</tr>"),h.map(e,function(t){i.push('<tr style="'+s+'">');for(var e=0;e<l.length;e++){var n=l[e],o=r.datagrid("getColumnOption",n),a=t[n];null==a&&(a="");n=c;n+=";text-align:"+(o.align||""),i.push('<td style="'+n+'">'+a+"</td>")}i.push("</tr>")}),i.push("</table>"),i.join("")}function i(t,e,n,o){e=(e=e||p(t)).concat(n||f(t));for(var a=h(t),o=o||a.datagrid("getColumnFields",!0).concat(a.datagrid("getColumnFields",!1)),l=[],r=[],i=0;i<o.length;i++){var s=a.datagrid("getColumnOption",o[i]);r.push(s.title)}return l.push(r),h.map(e,function(t){for(var e=[],n=0;n<o.length;n++)e.push(t[o[n]]);l.push(e)}),l}function u(t){for(var e=atob(t),n=[],o=0;o<e.length;o+=512){for(var a=e.slice(o,o+512),l=new Array(a.length),r=0;r<a.length;r++)l[r]=a.charCodeAt(r);var i=new Uint8Array(l);n.push(i)}return new Blob(n,{type:""})}h.extend(h.fn.datagrid.methods,{toHtml:function(t,e){return d(t[0],e)},toArray:function(t,e){return i(t[0],e)},toExcel:function(t,e){return t.each(function(){!function(t,e){var n=null,o=null,a=null,l=null,r=null,i="Worksheet";"string"==typeof e?n=e:(n=e.filename,o=e.rows,a=e.footer,l=e.caption,r=e.fields,i=e.worksheet||"Worksheet"),h(t);var s,c,r=d(t,o,a,l,r),r=(s={worksheet:i,table:r},i='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><meta http-equiv="content-type" content="application/vnd.ms-excel; charset=UTF-8"><head>\x3c!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--\x3e</head><body>{table}</body></html>'.replace(/{(\w+)}/g,function(t,e){return s[e]}),window.btoa(unescape(encodeURIComponent(i))));window.navigator.msSaveBlob?(c=u(r),window.navigator.msSaveBlob(c,n)):((c=h('<a style="display:none"></a>').appendTo("body"))[0].href="data:application/vnd.ms-excel;base64,"+r,c[0].download=n,c[0].click(),c.remove())}(this,e)})},toCsv:function(t,e){return t.each(function(){!function(t,e){var n=null,o=null,a=null,l=null;"string"==typeof e?n=e:(n=e.filename,o=e.rows,a=e.footer,l=e.fields);var r,l=i(t,o,a,l),l=h.map(l,function(t){return t.join(",")}).join("\r\n"),l=window.btoa(unescape(encodeURIComponent(l)));window.navigator.msSaveBlob?(r=u(l),window.navigator.msSaveBlob(r,n)):((r=h('<a style="display:none"></a>').appendTo("body"))[0].href="data:text/csv;charset=utf-8;base64,"+l,r[0].download=n,r[0].click(),r.remove())}(this,e)})},print:function(t,e){return t.each(function(){!function(t,e){var n=null,o=null,a=null,l=null,r=null;"string"==typeof e?n=e:(n=e.title,o=e.rows,a=e.footer,l=e.caption,r=e.fields);var i=window.open("","","width=800, height=500"),e=i.document.open(),r='<!doctype html><html><head><meta charset="utf-8"><title>'+n+"</title></head><body>"+d(t,o,a,l,r)+"</body></html>";e.write(r),e.close(),i.print()}(this,e)})}})}(jQuery);